# RTK Rover 配置指南 (XTRTK-1152FLY)

本指南说明如何配置 XTRTK-1152FLY rover 设备连接到 NTRIP 基站以获得 RTK 定位。

## 📋 配置前准备

### 1. 确认基站运行正常
使用 `ntrip_test.py` 测试基站是否正常工作：
```bash
python ntrip_test.py 192.168.137.172
```

应该看到：
- ✅ NTRIP stream started successfully
- RTCM 消息类型：1074, 1084, 1094, 1124, 1005, 1006, 1033

### 2. 基站 NTRIP 信息
根据你的配置，基站信息如下：
- **服务器地址**: `192.168.137.172`
- **端口**: `2101`
- **挂载点**: `RTCM4`
- **用户名**: `XTRTK`
- **密码**: `123456`
- **RTCM 消息**: `1074,1084,1094,1124,1005,1006,1033`

---

## 🔧 配置方法

### 方法 1: 使用 SW Map APP（推荐）

如果你已经在手机上使用 SW Map，这是最简单的方法：

1. **打开 SW Map APP**
2. **进入设备设置**
   - 找到你的 XTRTK-1152FLY 设备
   - 进入 "RTK设置" 或 "NTRIP设置"

3. **配置 NTRIP 客户端**：
   ```
   连接类型: NTRIP
   服务器地址: 192.168.137.172
   端口: 2101
   挂载点: RTCM4
   用户名: XTRTK
   密码: 123456
   ```

4. **启用 RTK 模式**
   - 确保 RTK 模式已启用
   - 选择 "RTK" 或 "RTK Auto" 模式

5. **保存并连接**
   - 保存配置
   - 启动 NTRIP 连接
   - 等待 RTK 收敛（通常 1-5 分钟）

---

### 方法 2: 通过串口配置（高级）

如果你的设备支持串口配置，可以通过串口发送命令：

#### 2.1 连接设备
- 通过蓝牙或 USB 连接到电脑
- 使用串口工具（如 PuTTY、Tera Term）连接到设备
- 波特率通常为 `115200`

#### 2.2 发送 NTRIP 配置命令

**注意**: XTRTK 设备的命令格式可能不同，以下是通用格式参考：

```
# 设置 NTRIP 服务器地址
SETNTRIP SERVER 192.168.137.172

# 设置端口
SETNTRIP PORT 2101

# 设置挂载点
SETNTRIP MOUNT RTCM4

# 设置用户名和密码
SETNTRIP USER XTRTK
SETNTRIP PASS 123456

# 启用 NTRIP 客户端
SETNTRIP ENABLE ON

# 启用 RTK 模式
SETRTK MODE ON
```

**实际命令格式请参考 XTRTK 设备手册**

---

### 方法 3: 使用设备 Web 界面

如果 XTRTK-1152FLY 有 Web 配置界面：

1. **连接到设备 WiFi** 或通过蓝牙访问
2. **打开浏览器**，访问设备 IP（通常是 `192.168.1.1` 或设备说明书中的地址）
3. **登录**（默认用户名/密码请查看设备手册）
4. **找到 RTK/NTRIP 设置页面**
5. **填写配置信息**：
   - NTRIP 服务器: `192.168.137.172:2101`
   - 挂载点: `RTCM4`
   - 用户名: `XTRTK`
   - 密码: `123456`
6. **保存并应用配置**

---

## ✅ 验证配置

### 1. 检查 NTRIP 连接状态

在 SW Map 或设备状态页面查看：
- ✅ NTRIP 连接状态：已连接
- ✅ RTCM 数据接收：正常
- ✅ 数据速率：约 200-500 B/s

### 2. 使用 rover_test.py 监控

运行测试程序：
```bash
python rover_test.py
```

**预期结果**：
- 初始：GPS Fix (质量代码 1)
- 1-3 分钟后：RTK Float (质量代码 5) 🟡
- 3-5 分钟后：RTK Fixed (质量代码 4) 🟢

### 3. 检查 RTK 状态

在 `rover_test.py` 输出中查看：
```
Status: 🟢 RTK FIXED (cm-level)
Quality Code: 4 (RTK Fixed)
⏱️  RTK Fixed achieved in 120.5s
```

---

## 🔍 故障排除

### 问题 1: 一直显示 GPS Fix，没有 RTK

**可能原因**：
- NTRIP 连接未建立
- RTCM 数据未接收
- 基站距离太远（> 20 km）

**解决方法**：
1. 检查 NTRIP 连接状态
2. 确认基站正在发送 RTCM 数据（使用 `ntrip_test.py` 验证）
3. 检查网络连接（rover 和基站在同一网络或可访问）
4. 确认 rover 和基站距离在有效范围内

### 问题 2: RTK Float 但无法升级到 RTK Fixed

**可能原因**：
- 卫星信号质量不佳
- 基站位置精度不够
- 多路径干扰

**解决方法**：
1. 确保天线位置良好（开阔天空）
2. 等待更长时间（可能需要 10-15 分钟）
3. 检查基站位置精度（基站需要精确坐标）

### 问题 3: NTRIP 连接失败

**可能原因**：
- 服务器地址错误
- 端口被防火墙阻挡
- 用户名/密码错误

**解决方法**：
1. 使用 `ntrip_test.py` 测试基站连接
2. 检查防火墙设置
3. 确认用户名和密码正确
4. 尝试 ping 基站 IP：`ping 192.168.137.172`

---

## 📊 RTK 质量代码说明

| 代码 | 名称 | 精度 | 说明 |
|------|------|------|------|
| 0 | No Fix | - | 无定位 |
| 1 | GPS | 米级 | 标准 GPS 定位 |
| 2 | DGPS | 亚米级 | 差分 GPS |
| 3 | PPS | - | PPS 模式 |
| **4** | **RTK Fixed** | **cm级** | **RTK 固定解（最佳）** |
| **5** | **RTK Float** | **dm级** | **RTK 浮点解（良好）** |
| 6 | Estimated | - | 估算模式 |
| 7 | Manual | - | 手动输入 |
| 8 | Simulation | - | 模拟模式 |

---

## 📝 配置检查清单

- [ ] 基站正常运行（`ntrip_test.py` 测试通过）
- [ ] Rover 设备已连接（蓝牙/USB）
- [ ] NTRIP 服务器地址正确：`192.168.137.172`
- [ ] NTRIP 端口正确：`2101`
- [ ] 挂载点正确：`RTCM4`
- [ ] 用户名正确：`XTRTK`
- [ ] 密码正确：`123456`
- [ ] RTK 模式已启用
- [ ] 天线位置良好（开阔天空）
- [ ] 网络连接正常（rover 可访问基站）

---

## 🎯 快速配置参考

### SW Map APP 配置
```
NTRIP 设置:
  服务器: 192.168.137.172
  端口: 2101
  挂载点: RTCM4
  用户名: XTRTK
  密码: 123456
```

### 预期时间线
- **0-1 分钟**: GPS Fix
- **1-3 分钟**: RTK Float 🟡
- **3-5 分钟**: RTK Fixed 🟢

---

## 📞 需要帮助？

如果遇到问题：
1. 检查 `rover_test.py` 的输出日志
2. 查看设备状态页面
3. 参考 XTRTK 设备手册
4. 确认基站和 rover 的配置匹配

---

**最后更新**: 2025-01-15

