# 蓝牙设备连接检查指南

## 🔍 问题：设备显示 "Not connected"

即使设备已配对，蓝牙串口服务可能没有连接。需要手动连接串口服务。

---

## 📋 检查步骤

### 方法 1: 通过设备管理器检查

1. **打开设备管理器**
   - 按 `Win + X`，选择"设备管理器"
   - 或右键"此电脑" > "属性" > "设备管理器"

2. **查找蓝牙串口**
   - 展开"端口 (COM 和 LPT)"
   - 查找 "Standard Serial over Bluetooth link" 或类似名称
   - 查看 COM 端口号（如 COM3, COM4）

3. **检查连接状态**
   - 如果端口有黄色感叹号，右键 > "更新驱动程序"
   - 如果端口存在但没有数据，可能需要重新连接

---

### 方法 2: 通过 Windows 设置检查

1. **打开蓝牙设置**
   - `Win + I` > "蓝牙和其他设备"
   - 或 `Win + K` 打开快速设置

2. **检查设备状态**
   - 找到 "XTRTK-1152FLY"
   - 如果显示"已配对"但"未连接"
   - 点击设备，选择"连接"或"更多蓝牙选项"

3. **连接串口服务**
   - 在设备详情中，查找"服务"或"服务"选项
   - 确保"串行端口"或"Serial Port"服务已启用

---

### 方法 3: 查看 SW Map 使用的端口

如果 SW Map 可以连接，查看它使用的 COM 端口：

1. **在 SW Map 中查看连接信息**
   - 打开 SW Map
   - 查看设备连接信息
   - 记录使用的 COM 端口号

2. **在配置文件中使用相同端口**
   ```json
   {
     "port": "COM4",  // 使用 SW Map 中显示的端口号
     "auto_detect": false
   }
   ```

---

## 🔧 手动连接蓝牙串口

### Windows 10/11

1. **打开设备管理器**
2. **展开"蓝牙"**
3. **找到 XTRTK-1152FLY**
4. **右键 > "属性" > "服务"**
5. **勾选"串行端口 (SPP)"**
6. **应用并确定**

### 或者通过命令行

1. **打开 PowerShell（管理员）**
2. **运行以下命令查看蓝牙设备：**
   ```powershell
   Get-PnpDevice | Where-Object {$_.FriendlyName -like "*XTRTK*"}
   ```

---

## ✅ 验证连接

运行 `rover_test.py`，应该能看到：

```
🔍 Searching for rover device...
   Step 1: Searching by device name...
      Found: COM4 - Standard Serial over Bluetooth link [Bluetooth]
   ✅ Found rover device by name: COM4
```

或者如果自动检测失败，手动指定端口：

```json
{
  "port": "COM4",  // 替换为你的实际端口号
  "auto_detect": false
}
```

---

## 🐛 常见问题

### 问题 1: 找不到 COM 端口

**解决方法：**
- 确保设备已配对
- 在设备管理器中检查是否有蓝牙串口
- 尝试重新配对设备

### 问题 2: 端口存在但无法连接

**解决方法：**
- 关闭其他使用该端口的程序（如 SW Map）
- 重启蓝牙服务
- 重新连接设备

### 问题 3: SW Map 能用但程序找不到

**解决方法：**
- 查看 SW Map 使用的端口号
- 在配置文件中手动指定该端口
- 确保 SW Map 已关闭（串口不能同时被两个程序使用）

---

## 💡 快速解决方案

**最简单的方法：**

1. **打开 SW Map，查看它使用的 COM 端口号**
2. **关闭 SW Map**
3. **编辑 `rover_config.json`：**
   ```json
   {
     "port": "COM4",  // 使用 SW Map 显示的端口号
     "auto_detect": false,
     "baudrate": 115200,
     "timeout": 1.0,
     "device_name": "XTRTK"
   }
   ```
4. **运行 `rover_test.py`**

---

**最后更新：** 2025-01-15



